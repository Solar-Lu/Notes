这篇文章的是关于如何提高深度学习库测试中约束的完整性和有效性，提出了一种名为DeepConstr的工具，通过互补集引导的约束细化方法，提升了深度学习库测试的完整性和有效性。
  
### 一、背景知识 

深度学习库（如PyTorch和TensorFlow）在人工智能系统中扮演着重要角色。这些库的可靠性至关重要，因为它们的错误可能导致严重后果，例如自动驾驶系统中的错误决策。为了确保这些库的可靠性，研究者们提出了多种方法来生成有效的测试用例，其中一种方法是通过建模张量操作的输入约束来指导测试用例的生成。然而，这些约束可能会限制搜索空间，导致测试不完整。

  就何为建模张量操作的输入约束，在深度学习库的测试中，就是通过数学公式或逻辑表达式来描述张量操作对输入的具体要求（比如形状、数据类型、值范围等），然后利用约束求解器（如Z3）找到满足这些约束的输入值，从而生成有效的测试用例。

  GPT给出如下例子：例如，对于一个卷积操作，我们定义约束为卷积核大小不能超过输入大小加上两倍填充大小（`kernel_size ≤ input_size + 2 × padding`），步幅必须大于零（`stride > 0`），填充不能为负（`padding ≥ 0`）。通过约束求解器，我们可以生成满足这些条件的具体输入值（如输入大小为10，卷积核大小为3，填充为2，步幅为1），并将其作为测试用例，用于检测深度学习库中该操作的正确性。这种方法可以高效地生成多样化的测试用例，提高测试覆盖率和深度学习库的可靠性。

### 二、研究方法


 文章提出了一种名为Complementary Set Guided Refinement的方法，旨在增强深度学习库中约束的完整性。该方法的基本思想是检查约束的互补集是否能生成有效的测试用例。如果可以，说明这些测试用例没有被原始约束所覆盖，即原始约束不完整，需要细化。

 基于此，作者设计了一个名为DeepConstr的自动化约束细化工具，该工具采用遗传算法来细化约束，以提高其完整性。

#### 约束细化过程

1. 原始约束探索：DeepConstr首先利用大型语言模型从错误信息中推断出一个原始约束。这个原始约束可能不完整或不准确。

2. 约束合成：将新生成的原始约束与高质量约束池中的约束进行组合，以提高约束的质量。合成过程包括特定合成（与已知为有效或完整的约束进行合成）和一般合成（与约束池中的其他约束进行合成）。特定合成是为了提高合成的完整性（or操作）有效性（and操作），一般约束可以探索更多可能的约束并且避免局部最优解。

3. 约束测量：通过定义适应度函数来评估约束的质量，该函数考虑了约束的完整性和有效性。通过生成测试用例并观察它们是否触发错误来评估约束的完整性和有效性。

#### 适应度函数

适应度函数是通过计算约束的完整性和有效性来定义的，具体如下：

 有效性soundness：约束在测试用例中是否总是解决目标错误状态，假设一个测试用例满足约束c，就不应该触发错误e，数值越高则有效性越强。

 完整性completeness：约束是否不会排除与解决错误无关的输入空间，假设测试用例不满足约束c即应当触发错误e，完整性表示的是互补集中触发错误的比例，比例越高，则不满足约束的测试用例越多，完整性越强。

适应度函数的计算公式为：
![DeepConstr](jpg/deepconstr.png)
![](file:///C:\Users\admin\AppData\Local\Temp\ksohtml22364\wps1.jpg) 

该自适应函数是取适应度有效性和完整性的调和平均数，取值0－1，接近1则约束的完整性和有效性越高，约束的质量也就越高。

### 三、实验

  作者在PyTorch和TensorFlow两个主流深度学习库上评估了DeepConstr的性能。实验结果显示，DeepConstr发现了84个之前未知的错误，其中72个被确认，51个已被修复。与现有的最先进的模糊测试工具相比，DeepConstr在分支覆盖率上取得了显著提升。

  DeepConstr在PyTorch中实现了58.27%的NeuRI（自动推断深度学习操作符约束的工具）支持的操作符和49.15%的NNSmith（基于手动编写的约束来生成测试用例工具）支持的操作符的更大覆盖率；在TensorFlow中，分别实现了62.1%的NeuRI和38.1%的NNSmith支持的操作符的更大覆盖率。

### 四、结论

1. 强调了在深度学习库测试中考虑约束完整性的重要性，并提出了一种新的方法来提高约束的完整性。

2. 通过实验验证，DeepConstr在发现深度学习库中的错误方面表现出色，能够生成更完整的约束，从而提高测试的覆盖率和有效性。

3. 实际应用，DeepConstr在实际应用中发现了多个之前未知的错误，这些错误已经被确认并部分修复，证明了其在实际深度学习库测试中的实用性和有效性。

### 五、局限性

尽管DeepConstr取得了显著的成果，但它也有一些局限性：

1. 如果错误信息不准确或与错误的实际问题无关，DeepConstr无法从错误信息中提取约束。由于LLMs的能力有限，无法理解模糊的描述信息或被错误信息误导。

2. 为了避免资源利用过度，DeepConstr没有对每个张量元素进行建模，因此无法支持与张量元素相关的约束。

### 六、未来工作

 文章提出了未来的研究方向，包括探索更精确的错误信息处理方法，以提高约束生成的效率和准确性，同时保持工具的可扩展性。此外，作者还计划将DeepConstr应用于其他深度学习框架，以验证其通用性。