# 1. 研究背景与动机

传统的恶意软件传播方式容易被安全软件检测，而现代攻击需要更隐蔽的传输手段。

**现有方法的不足：**
1. 隐写术：最低有效位替换在图像中隐藏数据，但容量有限。
2. 基于公共服务的C&C（Twitter、区块链）：适合小数据，但不适合传输大型恶意负载。

于是作者联想到利用神经网络模型的冗余性和不可解释性，将恶意代码嵌入模型参数中，实现隐蔽传输。

---

# 2. 核心方法：Fast Substitution

## 2.1 技术原理

evilmodel的目标是将恶意代码嵌入神经网络的权重和偏置中，同时保持模型性能。神经网络参数（特别是32位浮点数的后24位）存在冗余，部分神经元对模型输出影响极小，可以用来嵌入恶意代码。

**实验步骤：**
1. 分段恶意代码：按3字节分段读取恶意二进制文件。
2. 浮点数转换：为每3字节添加1字节前缀（正数：0x3C，负数：0xBC），形成合法的32位浮点数。
3. 替换参数：用转换后的浮点数覆盖原始神经元权重，偏置存储元数据（如长度、哈希）。
4. 性能调整：通过重训练（冻结被替换神经元）恢复模型准确率。

---

## 2.2 嵌入容量与性能影响

- **实验模型：** AlexNet（178MB），FashionMNIST数据集。
- **结果：**
  - 容量：在FC1层（4096神经元）中，单个神经元可嵌入12KB恶意代码，全层可嵌入约36.9MB。
  - 性能：替换25%神经元时，准确率仅下降0.12%（93.75% → 93.63%）。
  - 重训练效果：冻结被替换神经元后，准确率可恢复至接近原始水平。

---

## 2.3 隐蔽性验证

- **杀毒软件检测：** 上传嵌入恶意代码的模型至VirusTotal，58款引擎均未报毒（模型被识别为ZIP文件）。
- **结构一致性：** 模型架构未改变，仅参数值被替换，难以通过静态分析发现异常。

---

# 3. 对比现有方法

| 方法                | 嵌入容量 | 性能影响 | 隐蔽性         |
|---------------------|----------|----------|----------------|
| LSB                 | Low      | High     | 差             |
| ValueMapping        | Middle   | Middle   | 需额外映射表   |
| Resilience Training | High     | High     | 需重训练       |
| Fast Substitution   | High     | Low      | 无特征         |

---

# 4. 防御建议

根据evilmodel的注入情况，可以从以下方面进行防御：

- **模型验证：**
  - 参数分布分析：检测异常浮点数（如大量`0x3C`前缀）。
  - 哈希校验：对比官方模型的参数哈希。
- **供应链安全：**
  - 仅从可信源下载模型，启用代码签名验证。

---

# 5. 研究意义与局限

该模型的贡献，提出首个基于神经元替换的高容量恶意代码嵌入方法，揭示了AI模型在安全领域的新型攻击面，说明未来需开发针对模型参数的动态检测技术。

**局限：** 依赖全连接层（现代模型如Transformer可能不适用），且需攻击者能控制模型分发渠道。

---

# 6. 实验测试

## 6.1 加载预训练模型

由于作者没有提供原模型，所以需要自己重新进行加载。

加载预训练的ResNet50模型，对其权重进行特殊修改，并在CIFAR10数据集上做简单评估，最后保存修改后的模型权重。

![evil(1)](@jpg/evil(1).png)

如果直接对下载的模型进行嵌入，准确率很低而且损失值很高，根据文章可以冻结参数层进行微调，能显著提高模型的准确率并且降低损失：

![evil(2)](@jpg/evil(2).png)

---

## 6.2 文件嵌入

对于文本文件not_malware进行嵌入：

![evil(3)](@jpg/evil(3).png)

---

## 6.3 文件提取

![evil(4)](@jpg/evil(4).png)

在神经网络中嵌入任意数据（在攻击中可以是恶意软件），由于数据以权重的形式在文件中分割，因此很难检测，因此嵌入和未嵌入的文本文件没有区别。

![evil(5)](@jpg/evil(5).png)

计算两个文件的hash值，证明提取的文件和原始文件没有差别，说明这种方法的有效性：